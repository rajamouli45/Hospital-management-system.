<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Book Appointment</title>

<style>
    body {
        background-color: #0f1d1d;
        font-family: Arial, sans-serif;
        color: #e8ffff;
        margin: 0;
        padding: 0;
        text-align: center;
    }

    .header {
        background-color: #0b3939;
        padding: 18px 40px;
        border-bottom: 2px solid #1fa7a7;
        text-align: left;
        color: white;
        font-size: 20px;
        font-weight: bold;
    }

    .title {
        margin-top: 35px;
        font-size: 28px;
        font-weight: bold;
        color: #35f5f5;
    }

    .form-box {
        width: 400px;
        margin: 30px auto;
        border: 1.8px solid #1fa7a7;
        padding: 28px;
        border-radius: 10px;
        background-color: #102727;
        box-shadow: 0 0 15px #0d3c3c;
        text-align: left;
    }

    label {
        display: block;
        margin-top: 14px;
        font-size: 16px;
    }

    input, textarea {
        width: 100%;
        padding: 8px;
        margin-top: 6px;
        background-color: #0f1d1d;
        border: 1.5px solid #1fa7a7;
        border-radius: 6px;
        color: #e8ffff;
        font-size: 15px;
        outline: none;
    }

    input:hover, textarea:hover {
        border-color: #35f5f5;
    }

    .status-row {
        display: flex;
        align-items: center;
        margin-top: 10px;
        gap: 12px;
    }

    .status-row input[type="checkbox"] {
        transform: scale(1.6);
        cursor: pointer;
    }

    .time-note {
        font-size: 12px;
        color: #87ffff;
        margin-top: 3px;
    }

    .book-btn {
        width: 100%;
        margin-top: 25px;
        padding: 10px 0;
        background-color: #1fa7a7;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        color: black;
        transition: 0.3s;
    }

    .book-btn:hover {
        background-color: #35f5f5;
        transform: scale(1.05);
    }
</style>
</head>

<body>

<div class="header">APOLLO HOSPITALS</div>

<div class="title">Book Appointment</div>

<div class="form-box">
    <form id="appointmentForm">

        <label>Appointment Date:</label>
        <input type="date" id="appointmentDate" required>

        <label>Appointment Time:</label>
        <input type="time" id="appointmentTime" required>
        <div class="time-note">* Enter Time in 24-hour format (Example: 14:30)</div>

        <label>Reason:</label>
        <textarea id="reason" rows="2" required></textarea>

        <label>Status:</label>
        <div class="status-row">
            <label style="margin:0;">Scheduled</label>
            <input type="checkbox" id="status">
        </div>

        <label>Patient ID (Format: P24xxx):</label>
        <input type="text" id="patientId" placeholder="e.g., P24001" pattern="P24[0-9]{3}" required>

        <label>Doctor ID (Format: DOCxxx):</label>
        <input type="text" id="doctorId" placeholder="e.g., DOC001" pattern="DOC[0-9]{3}" required>

        <button type="button" class="book-btn" onclick="bookAppointment()">BOOK NOW</button>

    </form>
</div>

<script>
function bookAppointment() {
    const date = document.getElementById("appointmentDate").value;
    const time = document.getElementById("appointmentTime").value;
    const reason = document.getElementById("reason").value.trim();
    const status = document.getElementById("status").checked ? "Scheduled" : "Pending";
    const patientId = document.getElementById("patientId").value.trim();
    const doctorId = document.getElementById("doctorId").value.trim();

    if (!date || !time || !reason || !patientId || !doctorId) {
        alert("⚠️ Please fill all fields before booking.");
        return;
    }

    if (!/^P24[0-9]{3}$/.test(patientId)) {
        alert("⚠️ Patient ID must be in format: P24xxx (Example: P24012)");
        return;
    }

    if (!/^DOC[0-9]{3}$/.test(doctorId)) {
        alert("⚠️ Doctor ID must be in format: DOCxxx (Example: DOC007)");
        return;
    }

    // ✅ Send data to Flask backend
    fetch("/book_appointment", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            appointment_date: date,
            appointment_time: time,
            reason: reason,
            status: status,
            patient_id: patientId,
            doctor_id: doctorId
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert("✅ Appointment booked successfully!");
            document.getElementById("appointmentForm").reset();
        } else {
            alert("❌ " + data.message);
        }
    })
    .catch(error => {
        console.error("Error:", error);
        alert("❌ Failed to connect to server. Please try again.");
    });
}
</script>

<!-- ✅ Fallback for browsers without native date picker -->
<script>
    const dateInput = document.getElementById("appointmentDate");
    if (dateInput.type !== "date") {
        const script = document.createElement("script");
        script.src = "https://code.jquery.com/ui/1.13.2/jquery-ui.js";
        document.body.appendChild(script);

        const link = document.createElement("link");
        link.rel = "stylesheet";
        link.href = "https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css";
        document.head.appendChild(link);

        script.onload = () => {
            $(dateInput).datepicker({ dateFormat: "yy-mm-dd" });
        };
    }
</script>

</body>
</html>
